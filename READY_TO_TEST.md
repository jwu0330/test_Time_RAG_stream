# ✅ 系統測試準備完成

## 🎯 系統狀態

### 已完成 ✅
- [x] 四向度分類系統（D1-D4）
- [x] 並行處理架構
- [x] 情境匹配系統（24 種）
- [x] 知識點關聯管理
- [x] 歷史記錄追蹤
- [x] Web 界面
- [x] 測試腳本

### 待完成 ⏳
- [ ] 擴展教材到 5000 字（您稍後完成）
- [ ] 調整情境提示詞（您稍後確認）

---

## 🚀 立即測試系統

### 方法 1：完整測試（推薦）

```bash
python RUN_TEST.py
```

這個腳本會：
1. ✅ 自動生成 24 個情境文件
2. ✅ 初始化系統和向量化
3. ✅ 執行 3 個測試查詢
4. ✅ 驗證情境匹配和顯示

**預期輸出**：
- 每個回答會顯示「現在是第 X 種情境」
- 會列出四個向度的分析結果
- 會顯示時間報告

### 方法 2：並行系統測試

```bash
python main_parallel.py
```

直接運行並行處理系統。

### 方法 3：Web 界面測試

```bash
# 先生成情境文件
python generate_scenarios_now.py

# 啟動 Web API
python web_api.py

# 在瀏覽器打開
open web_interface.html
```

---

## 📋 測試前檢查

### 必須設定
```bash
# 設定 OpenAI API Key
export OPENAI_API_KEY="your-api-key-here"
```

### 必須安裝
```bash
# 安裝依賴（如果尚未安裝）
pip install -r requirements.txt
```

### 文件結構
```
test_Time_RAG_stream/
├── docs/                    # 教材文件（現有示例）
│   ├── ml_basics.txt
│   ├── deep_learning.txt
│   └── nlp_intro.txt
├── scenarios_24/            # 24 個情境（會自動生成）
│   ├── scenario_01.json
│   ├── ...
│   └── scenario_24.json
├── config.py               # 配置文件
├── main_parallel.py        # 並行處理主程序
├── scenario_matcher.py     # 情境匹配器
├── knowledge_relations.json # 知識點關聯
└── RUN_TEST.py            # 完整測試腳本
```

---

## 🎭 24 種情境說明

### 情境編號規則

每個情境由四個向度組合而成：

| 編號 | D1 | D2 | D3 | D4 | 說明 |
|------|----|----|----|----|------|
| 01 | 零個 | 有錯誤 | 非常詳細 | 重複狀態 | 未匹配知識點，表達有誤，問題詳細，重複詢問 |
| 02 | 零個 | 有錯誤 | 非常詳細 | 正常狀態 | 未匹配知識點，表達有誤，問題詳細，首次詢問 |
| ... | ... | ... | ... | ... | ... |
| 08 | 一個 | 無錯誤 | 粗略 | 正常狀態 | **最常見情境** |
| ... | ... | ... | ... | ... | ... |
| 24 | 多個 | 無錯誤 | 未談及重點 | 正常狀態 | 多個知識點，表達正確，問題不明確，首次詢問 |

### 情境顯示格式

每個回答會包含：

```
現在是第 X 種情境

四向度分析結果：
- D1 (知識點數量): 一個
- D2 (表達錯誤): 無錯誤
- D3 (表達詳細度): 粗略
- D4 (重複詢問): 正常狀態

[根據教材內容的實際回答...]
```

---

## 🧪 測試案例

### 案例 1：簡單問題（預期：情境 8 或類似）
```
問題：什麼是機器學習？

預期結果：
- D1: 一個（匹配 ml_basics.txt）
- D2: 無錯誤
- D3: 粗略
- D4: 正常狀態
- 情境：約第 8 種
```

### 案例 2：多知識點問題（預期：情境 18 或類似）
```
問題：機器學習和深度學習有什麼區別？

預期結果：
- D1: 多個（匹配 ml_basics.txt + deep_learning.txt）
- D2: 無錯誤
- D3: 粗略或非常詳細
- D4: 正常狀態
- 情境：約第 18-20 種
- 會顯示知識點關聯信息
```

### 案例 3：重複問題（預期：D4 = 重複狀態）
```
連續問 3 次類似問題：
1. 什麼是機器學習？
2. 機器學習是什麼？
3. 請解釋機器學習
4. 再說一次機器學習的定義 ← 這次 D4 應為「重複狀態」
```

---

## 📊 預期輸出示例

### 完整輸出格式

```
============================================================
🔍 處理查詢: 什麼是機器學習？
============================================================

🚀 階段 1：啟動並行分析...
  ✅ RAG 檢索完成：找到 1 個文件
  ✅ D2 分析完成：無錯誤
  ✅ D3 分析完成：粗略
  ✅ D1 分析完成：一個
  ✅ D4 分析完成：正常狀態

🎯 階段 2：判定情境...
  ✅ 判定為第 8 個情境：一個+無錯誤+粗略+正常狀態

🔗 階段 3：合併數據到主線程...
  ✅ 數據合併完成
     - RAG 上下文：1381 字
     - 知識點：機器學習基礎
     - 情境數據：已載入

⚙️  階段 4：主線程處理...

💬 生成最終答案...
--------------------------------------------------
現在是第 8 種情境

四向度分析結果：
- D1 (知識點數量): 一個
- D2 (表達錯誤): 無錯誤
- D3 (表達詳細度): 粗略
- D4 (重複詢問): 正常狀態

機器學習是一種人工智能的分支...
[詳細回答內容...]
--------------------------------------------------

============================================================
📊 處理結果摘要
============================================================
查詢：什麼是機器學習？

情境：第 8 個 - 一個+無錯誤+粗略+正常狀態

四向度：
  D1 (知識點數量): 一個
  D2 (表達錯誤): 無錯誤
  D3 (表達詳細度): 粗略
  D4 (重複詢問): 正常狀態

知識點：機器學習基礎

時間報告：
  並行分析: 1.234s
  情境判定: 0.056s
  數據合併: 0.012s
  主線程處理: 2.345s
  總計: 3.647s
============================================================
```

---

## ⚠️ 常見問題

### Q1: 沒有設定 API Key
```
錯誤：OpenAI API key not found

解決：
export OPENAI_API_KEY="your-api-key"
```

### Q2: 找不到情境文件
```
錯誤：情境目錄不存在: scenarios_24

解決：
python generate_scenarios_now.py
# 或直接運行
python RUN_TEST.py
```

### Q3: 向量文件不存在
```
首次運行會自動向量化，需要：
1. 確保有 API Key
2. 確保 docs/ 目錄有文件
3. 等待向量化完成（約 10-30 秒）
```

### Q4: 情境沒有正確顯示
```
檢查：
1. scenarios_24/ 目錄是否存在
2. 是否有 24 個 JSON 文件
3. scenario_matcher.py 是否正確載入
```

---

## ✅ 最終確認清單

### 系統文件
- [x] `main_parallel.py` - 並行處理主程序
- [x] `scenario_matcher.py` - 情境匹配器
- [x] `scenario_module.py` - 四向度分類器
- [x] `history_manager.py` - 歷史管理器
- [x] `knowledge_relations.json` - 知識點關聯
- [x] `config.py` - 配置文件
- [x] `RUN_TEST.py` - 測試腳本
- [x] `generate_scenarios_now.py` - 情境生成器

### 測試準備
- [ ] 已設定 OPENAI_API_KEY
- [ ] 已安裝依賴（pip install -r requirements.txt）
- [ ] docs/ 目錄有教材文件
- [ ] 準備好運行測試

### 預期結果
- [ ] 系統能正常啟動
- [ ] 能自動生成 24 個情境文件
- [ ] 能正確匹配情境
- [ ] 回答中顯示「現在是第 X 種情境」
- [ ] 顯示四個向度的分析結果
- [ ] 時間報告正常

---

## 🚀 開始測試

### 一鍵測試
```bash
# 確保已設定 API Key
export OPENAI_API_KEY="your-api-key"

# 運行完整測試
python RUN_TEST.py
```

### 預計時間
- 生成情境文件：< 1 秒
- 首次向量化：10-30 秒
- 每個查詢：3-5 秒
- 總計：約 1-2 分鐘

---

## 📝 測試後

測試完成後，您可以：

1. **查看生成的情境文件**
   ```bash
   ls scenarios_24/
   cat scenarios_24/scenario_08.json
   ```

2. **查看向量文件**
   ```bash
   ls -lh vectors.pkl
   ```

3. **查看歷史記錄**
   ```bash
   cat history.json
   ```

4. **繼續擴展**
   - 擴展 docs/ 中的教材到 5000 字
   - 調整 scenarios_24/ 中的情境內容
   - 根據需求修改提示詞模板

---

## 🎉 準備就緒！

系統已完全準備好進行測試。

**立即執行**：
```bash
python RUN_TEST.py
```

祝測試順利！🚀
