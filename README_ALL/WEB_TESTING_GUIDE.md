# Web 界面測試指南

## ✅ 已修復的問題

### 1. API 端點修復
- ✅ 使用正確的 `process_query_parallel()` 方法
- ✅ 返回正確的響應格式
- ✅ 添加詳細的錯誤日誌

### 2. 前端優化
- ✅ 添加詳細的 console.log 調試信息
- ✅ 改進訊息顯示邏輯
- ✅ 確保內容正確渲染
- ✅ 自動滾動到最新訊息

---

## 🧪 測試步驟

### 步驟 1：確保 API 正在運行

```bash
# 檢查 API 狀態
curl http://localhost:8000/api/health

# 應該返回：
# {"status":"healthy","system_initialized":true,"history_loaded":true}
```

### 步驟 2：刷新瀏覽器

```bash
# 在瀏覽器中按 F5 或 Ctrl+R 刷新頁面
```

### 步驟 3：打開開發者工具

```
按 F12 打開開發者工具
切換到 Console 標籤
```

### 步驟 4：發送測試問題

```
輸入：什麼是機器學習？
點擊發送
```

### 步驟 5：查看 Console 日誌

你應該看到：
```
📤 發送訊息: 什麼是機器學習？
移除歡迎訊息
顯示用戶訊息
➕ 添加user訊息: 什麼是機器學習？
✅ 訊息已添加到 DOM
🔄 調用 API...
⏱️ API 響應時間: 3.45s
✅ 收到回應: {answer: "...", dimensions: {...}, ...}
顯示助手回答
➕ 添加assistant訊息: 機器學習是人工智能的一個分支...
✅ 訊息已添加到 DOM
```

---

## 🔍 調試檢查清單

### 前端檢查

- [ ] 頁面正常載入
- [ ] 歡迎訊息顯示
- [ ] 輸入框可以輸入
- [ ] 點擊範例問題有反應
- [ ] 發送按鈕可以點擊

### API 檢查

- [ ] API 健康檢查通過
- [ ] POST /api/query 返回 200
- [ ] 響應包含 answer 欄位
- [ ] 響應包含 dimensions 欄位

### 訊息顯示檢查

- [ ] 用戶訊息顯示（藍色氣泡，右側）
- [ ] 助手訊息顯示（灰色氣泡，左側）
- [ ] 四向度標籤顯示
- [ ] 響應時間顯示
- [ ] 自動滾動到底部

---

## 🐛 常見問題

### 問題 1：訊息不顯示

**檢查**：
1. 打開 Console 查看是否有錯誤
2. 檢查 `addMessage` 是否被調用
3. 檢查 DOM 中是否有訊息元素

**解決**：
```javascript
// 在 Console 中手動測試
addMessage('user', '測試訊息');
```

### 問題 2：API 返回 500 錯誤

**檢查後端日誌**：
```bash
# 查看終端中的錯誤信息
# 應該看到詳細的 traceback
```

**常見原因**：
- OpenAI API Key 未設定
- 向量文件不存在
- 情境文件路徑錯誤

### 問題 3：歡迎訊息不消失

**解決**：
```javascript
// 在 Console 中手動移除
document.querySelector('.welcome-message')?.remove();
```

### 問題 4：回答內容為空

**檢查 API 響應**：
```javascript
// 在 Console 中查看
console.log(data);
// 應該有 answer 欄位
```

---

## 📊 預期的完整流程

### 1. 用戶輸入
```
用戶輸入：什麼是機器學習？
點擊發送
```

### 2. 前端處理
```
✅ 清空輸入框
✅ 移除歡迎訊息
✅ 顯示用戶訊息（藍色氣泡）
✅ 顯示載入動畫（三個跳動的點）
✅ 禁用發送按鈕
```

### 3. API 調用
```
POST http://localhost:8000/api/query
Body: {"query": "什麼是機器學習？"}
```

### 4. 後端處理
```
✅ 並行分析 D2、D3、D4
✅ RAG 檢索相關文件
✅ D1 分析知識點數量
✅ 情境匹配
✅ 生成最終答案
```

### 5. 前端顯示
```
✅ 移除載入動畫
✅ 顯示助手回答（灰色氣泡）
✅ 顯示四向度標籤
✅ 顯示響應時間
✅ 顯示匹配文件數
✅ 更新統計資訊
✅ 啟用發送按鈕
```

### 6. 最終畫面
```
┌─────────────────────────────────┐
│ 用戶: 什麼是機器學習？           │ (藍色，右側)
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 助手: 機器學習是人工智能的一個   │ (灰色，左側)
│ 分支，它使計算機能夠從數據中     │
│ 學習並改進性能...               │
│                                 │
│ ⏱️ 3.5s  📄 2個文件  🎯 scenario_08 │
│ [D1: 一個] [D2: 無錯誤]         │
│ [D3: 粗略] [D4: 正常狀態]       │
└─────────────────────────────────┘
```

---

## 🎯 測試用例

### 測試 1：基礎問題
```
問題：什麼是機器學習？
預期：
- D1: 一個
- D2: 無錯誤
- D3: 粗略
- D4: 正常狀態
- 匹配文件：ml_basics.txt
```

### 測試 2：比較問題
```
問題：深度學習和機器學習有什麼不同？
預期：
- D1: 多個
- D2: 無錯誤
- D3: 非常詳細
- D4: 正常狀態
- 匹配文件：ml_basics.txt, deep_learning.txt
```

### 測試 3：重複問題
```
第一次問：什麼是機器學習？
第二次問：什麼是機器學習？
第三次問：什麼是機器學習？
預期：
- D4 應該變成：重複狀態
```

---

## 📝 調試命令

### 查看 API 狀態
```bash
curl http://localhost:8000/api/health
```

### 手動測試 API
```bash
curl -X POST http://localhost:8000/api/query \
  -H "Content-Type: application/json" \
  -d '{"query":"什麼是機器學習？"}'
```

### 查看 Console 日誌
```javascript
// 在瀏覽器 Console 中
console.log('測試');
```

---

## ✅ 成功標誌

當一切正常時，你應該看到：

1. ✅ 用戶訊息立即顯示
2. ✅ 載入動畫出現
3. ✅ 3-5 秒後載入動畫消失
4. ✅ 助手回答顯示
5. ✅ 四向度標籤正確顯示
6. ✅ 響應時間顯示
7. ✅ 統計資訊更新
8. ✅ 可以繼續發送新問題

---

**現在刷新頁面，打開 Console，然後測試！** 🎉
